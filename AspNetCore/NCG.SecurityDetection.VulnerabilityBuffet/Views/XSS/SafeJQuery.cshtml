
@{
    ViewData["Title"] = "XSS via jQuery";
}

<h1>@ViewData["Title"]</h1>
<partial name="_Menu" />
<div class="attack-page-content">
    <p>
        This page safely processes text passed back from the server in order to do the search. 
        It is here to help look for false positives in DAST scanners.
    </p>
    <div>
        <label for="SearchText">Search Text:</label>
        <input type="text" id="SearchText" />
    </div>
    <button onclick="RunSearch();">Search</button>
    <h2>You searched for: <span id="SearchedFor">@ViewBag.SearchText</span></h2>
    <table width="100%" id="SearchResult">
        <tr><th>ID</th><th>Food Name</th><th>Food Group</th><th>Calories</th><th>Protein</th><th>Fat</th><th>Carbohydrates</th></tr>
    </table>
</div>

@section Scripts
{
    <script>
        function RunSearch() {
            var searchText = $("#SearchText").val();

            $.ajax({
                type: "POST",
                data: JSON.stringify({ text: searchText }),
                dataType: "json",
                url: "/XSS/SearchByName/",
                success: function (response) {
                    $(".search-row").remove();
                    $("#SearchedFor").text(response.id);

                    var result = $("#SearchResult");

                    for (var i = 0; i < response.foods.length; i++) {
                        var tr = $("<tr></tr>");
                        tr.addClass("search-row");

                        AppendCell(tr, response.foods[i].foodID);
                        AppendCell(tr, response.foods[i].foodName);
                        AppendCell(tr, response.foods[i].foodGroup);
                        AppendCell(tr, response.foods[i].calories);
                        AppendCell(tr, response.foods[i].protein);
                        AppendCell(tr, response.foods[i].fat);
                        AppendCell(tr, response.foods[i].carbohydrates);

                        result.append(tr);
                    }
                }
            });
        }

        function AppendCell(cell, text) { 
            let td = $("<td></td>");
            td.text(text);
            cell.append(td);
        }
    </script>
}