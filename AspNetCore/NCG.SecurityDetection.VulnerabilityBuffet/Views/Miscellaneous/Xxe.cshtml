
@{
    ViewData["Title"] = "XML External Entities (XXE)";
}

@model AccountUserViewModel

<h1>XML External Entities (XXE)</h1>
<partial name="_Menu" />
<div class="attack-page-content">
    <p>This page is vulnerable to XML External Entities attacks. As a bonus, it is also vulnerable to SQL Injection attacks.</p>
    <div>
        <div>
            <label for="SearchFor">Search For:</label>
            <select id="SearchFor">
                <option value="FoodGroup">Food Group</option>
                <option value="FoodName">Food Name</option>
            </select>
        </div>
        <div>
            <label for="SearchType">Search Type:</label>
            <select id="SearchType">
                <option value="LIKE">Contains</option>
                <option value="EQUALS">Exact Match</option>
            </select>
        </div>
        <div>
            <label for="SearchText">Search Text:</label>
            <input type="text" id="SearchText" />
        </div>
        <button onclick="RunSearch();">Search</button>
    </div>

    <h2>You searched for: <span id="SearchedFor">@ViewBag.SearchText</span></h2>
    <table width="100%" id="SearchResult">
        <tr><th>ID</th><th>Food Name</th><th>Food Group</th><th>Calories</th><th>Protein</th><th>Fat</th><th>Carbohydrates</th></tr>
    </table>
</div>

<script>
    function RunSearch() {
        $.ajax({
            type: "POST",
            contentType: "text/xml",
            dataType: "text",
            data: GetSearchData(),
            url: "/Miscellaneous/XxeSearch",
            success: function (response) {
                var asJson = jQuery.parseJSON(response);
                $(".search-row").remove();
                $("#SearchedFor").text(asJson.searchText);

                for (var i = 0; i < asJson.foods.length; i++) {
                    $("#SearchResult").append('<tr class="search-row"><td>' + asJson.foods[i].foodID +
                        '</td><td>' + asJson.foods[i].foodName +
                        '</td><td>' + asJson.foods[i].foodGroup +
                        '</td><td>' + asJson.foods[i].calories +
                        '</td><td>' + asJson.foods[i].protein +
                        '</td><td>' + asJson.foods[i].fat +
                        '</td><td>' + asJson.foods[i].carbohydrates + '</td></tr>');
                }
            }
        });
    }

    function GetSearchData() {
        return '<?xml version="1.0"?><search><for>' + $("#SearchFor").val() + '</for><type>' + $("#SearchType").val() + '</type><text>' + $("#SearchText").val() + '</text></search>';
    }
</script>
