
@{
    ViewData["Title"] = "JavaScript Injection";
}

<h1>@ViewData["Title"]</h1>
<partial name="_Menu" />
<div class="attack-page-content">
    <p>
        Data in the &quot;foodId&quot; query string parameter is added to a page script unsafely.
        Try searching for a name of:
    </p>
    <p><code>beef&quot;; alert(1); var temp = &quot;</code></p>
    <h2>You searched for: <span id="SearchedFor">@ViewBag.SearchText</span></h2>
    <table width="100%" id="SearchResult">
        <tr><th>ID</th><th>Food Name</th><th>Food Group</th><th>Calories</th><th>Protein</th><th>Fat</th><th>Carbohydrates</th></tr>
    </table>
</div>

@section Scripts
{
    <script>
        var id = "@Html.Raw(ViewBag.SearchText)";

        function RunSearch() {
            $.ajax({
                type: "POST",
                dataType: "text",
                url: "/Miscellaneous/SearchByName/" + id,
                success: function (response) {
                    var asJson = jQuery.parseJSON(response);
                    $(".search-row").remove();
                    //$("#SearchedFor").text(asJson.searchText);

                    for (var i = 0; i < asJson.foods.length; i++) {
                        $("#SearchResult").append('<tr class="search-row"><td>' + asJson.foods[i].foodID +
                            '</td><td>' + asJson.foods[i].foodName +
                            '</td><td>' + asJson.foods[i].foodGroup +
                            '</td><td>' + asJson.foods[i].calories +
                            '</td><td>' + asJson.foods[i].protein +
                            '</td><td>' + asJson.foods[i].fat +
                            '</td><td>' + asJson.foods[i].carbohydrates + '</td></tr>');
                    }
                }
            });
        }

        RunSearch();
    </script>
}