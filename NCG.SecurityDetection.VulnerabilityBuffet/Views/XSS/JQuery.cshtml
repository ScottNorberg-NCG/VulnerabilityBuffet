
@{
    ViewData["Title"] = "XSS via jQuery";
}

<h1>@ViewData["Title"]</h1>
<partial name="_Menu" />
<div class="attack-page-content">
    <p>
        This page unsafely processes text passed back from the server in order to do the search.
    </p>
    <div>
        <label for="SearchText">Search Text:</label>
        <input type="text" id="SearchText" />
    </div>
    <button onclick="RunSearch();">Search</button>
    <h2>You searched for: <span id="SearchedFor">@ViewBag.SearchText</span></h2>
    <table width="100%" id="SearchResult">
        <tr><th>ID</th><th>Food Name</th><th>Food Group</th><th>Calories</th><th>Protein</th><th>Fat</th><th>Carbohydrates</th></tr>
    </table>
</div>

@section Scripts
{
    <script>
        function RunSearch() {
            var searchText = $("#SearchText").val();

            $.ajax({
                type: "POST",
                data: JSON.stringify({ text: searchText }),
                dataType: "json",
                url: "/XSS/SearchByName/",
                success: function (response) {
                    $(".search-row").remove();
                    $("#SearchedFor").html(response.id);

                    for (var i = 0; i < response.foods.length; i++) {
                        $("#SearchResult").append('<tr class="search-row"><td>' + response.foods[i].foodID +
                            '</td><td>' + response.foods[i].foodName +
                            '</td><td>' + response.foods[i].foodGroup +
                            '</td><td>' + response.foods[i].calories +
                            '</td><td>' + response.foods[i].protein +
                            '</td><td>' + response.foods[i].fat +
                            '</td><td>' + response.foods[i].carbohydrates + '</td></tr>');
                    }
                }
            });
        }
    </script>
}